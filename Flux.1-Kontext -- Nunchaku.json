{"id":"7cbcec68-7fa6-47bb-a38a-da689949a001","revision":0,"last_node_id":194,"last_link_id":303,"nodes":[{"id":135,"type":"ConditioningZeroOut","pos":[250,200],"size":[240,26],"flags":{"collapsed":false},"order":14,"mode":0,"inputs":[{"localized_name":"conditioning","name":"conditioning","type":"CONDITIONING","link":237}],"outputs":[{"localized_name":"CONDITIONING","name":"CONDITIONING","type":"CONDITIONING","links":[238]}],"properties":{"cnr_id":"comfy-core","ver":"0.3.39","Node name for S&R":"ConditioningZeroOut","widget_ue_connectable":{}},"widgets_values":[]},{"id":173,"type":"PreviewImage","pos":[320,860],"size":[420,310],"flags":{},"order":18,"mode":0,"inputs":[{"localized_name":"images","name":"images","type":"IMAGE","link":289}],"outputs":[],"properties":{"cnr_id":"comfy-core","ver":"0.3.40","Node name for S&R":"PreviewImage","widget_ue_connectable":{}},"widgets_values":[]},{"id":147,"type":"LoadImageOutput","pos":[-50,770],"size":[320,374],"flags":{},"order":0,"mode":4,"inputs":[{"localized_name":"image","name":"image","type":"COMBO","widget":{"name":"image"},"link":null},{"localized_name":"upload","name":"upload","type":"IMAGEUPLOAD","widget":{"name":"upload"},"link":null}],"outputs":[{"localized_name":"IMAGE","name":"IMAGE","type":"IMAGE","links":[250]},{"localized_name":"MASK","name":"MASK","type":"MASK","links":null}],"properties":{"cnr_id":"comfy-core","ver":"0.3.40","Node name for S&R":"LoadImageOutput","widget_ue_connectable":{}},"widgets_values":["ComfyUI_01226_.png [output]",false,"refresh","image"],"color":"#322","bgcolor":"#533"},{"id":8,"type":"VAEDecode","pos":[530,350],"size":[190,46],"flags":{"collapsed":false},"order":22,"mode":0,"inputs":[{"localized_name":"samples","name":"samples","type":"LATENT","link":52},{"localized_name":"vae","name":"vae","type":"VAE","link":61}],"outputs":[{"localized_name":"IMAGE","name":"IMAGE","type":"IMAGE","slot_index":0,"links":[240]}],"properties":{"cnr_id":"comfy-core","ver":"0.3.38","Node name for S&R":"VAEDecode","widget_ue_connectable":{}},"widgets_values":[]},{"id":124,"type":"VAEEncode","pos":[-20,400],"size":[240,50],"flags":{"collapsed":false},"order":17,"mode":0,"inputs":[{"localized_name":"pixels","name":"pixels","type":"IMAGE","link":222},{"localized_name":"vae","name":"vae","type":"VAE","link":223}],"outputs":[{"localized_name":"LATENT","name":"LATENT","type":"LATENT","links":[291,293]}],"properties":{"cnr_id":"comfy-core","ver":"0.3.39","Node name for S&R":"VAEEncode","widget_ue_connectable":{}},"widgets_values":[]},{"id":42,"type":"FluxKontextImageScale","pos":[-50,570],"size":[270,30],"flags":{"collapsed":false},"order":16,"mode":0,"inputs":[{"localized_name":"image","name":"image","type":"IMAGE","link":251}],"outputs":[{"localized_name":"IMAGE","name":"IMAGE","type":"IMAGE","links":[222,289]}],"properties":{"cnr_id":"comfy-core","ver":"0.3.38","Node name for S&R":"FluxKontextImageScale","widget_ue_connectable":{}},"widgets_values":[]},{"id":175,"type":"MarkdownNote","pos":[-50,640],"size":[320,88],"flags":{},"order":1,"mode":0,"inputs":[],"outputs":[],"title":"About Flux Kontext Edit","properties":{"widget_ue_connectable":{}},"widgets_values":["[English] Use Ctrl + B to enable multipule image input.\n\n[中文] 使用 **Ctrl + B** 来启用多张图片输入"],"color":"#432","bgcolor":"#653"},{"id":146,"type":"ImageStitch","pos":[-390,570],"size":[270,150],"flags":{},"order":15,"mode":0,"inputs":[{"localized_name":"image1","name":"image1","type":"IMAGE","link":299},{"localized_name":"image2","name":"image2","shape":7,"type":"IMAGE","link":250},{"localized_name":"direction","name":"direction","type":"COMBO","widget":{"name":"direction"},"link":null},{"localized_name":"match_image_size","name":"match_image_size","type":"BOOLEAN","widget":{"name":"match_image_size"},"link":null},{"localized_name":"spacing_width","name":"spacing_width","type":"INT","widget":{"name":"spacing_width"},"link":null},{"localized_name":"spacing_color","name":"spacing_color","type":"COMBO","widget":{"name":"spacing_color"},"link":null}],"outputs":[{"localized_name":"IMAGE","name":"IMAGE","type":"IMAGE","links":[251]}],"properties":{"cnr_id":"comfy-core","ver":"0.3.40","Node name for S&R":"ImageStitch","widget_ue_connectable":{}},"widgets_values":["right",true,0,"white"]},{"id":185,"type":"MarkdownNote","pos":[-960,490],"size":[510,170],"flags":{},"order":2,"mode":0,"inputs":[],"outputs":[],"title":"About VRAM","properties":{"widget_ue_connectable":{}},"widgets_values":["For reference:\n- **fp8_scaled**: Requires about 20GB of VRAM.\n- **Original**: Requires about 32GB of VRAM.\n\n---\n\n供参考：\n-  **fp8_scaled** :  大概需要 20GB 左右 VRAM \n- **原始权重**:  原始权重，大概需要 32GB 左右 VRAM \n"],"color":"#432","bgcolor":"#653"},{"id":186,"type":"MarkdownNote","pos":[-960,710],"size":[510,170],"flags":{},"order":3,"mode":0,"inputs":[],"outputs":[],"title":"Flux Kontext Prompt Techniques","properties":{"widget_ue_connectable":{}},"widgets_values":["\n## Flux Kontext Prompt Techniques\n\n### 1. Basic Modifications\n- Simple and direct: `\"Change the car color to red\"`\n- Maintain style: `\"Change to daytime while maintaining the same style of the painting\"`\n\n### 2. Style Transfer\n**Principles:**\n- Clearly name style: `\"Transform to Bauhaus art style\"`\n- Describe characteristics: `\"Transform to oil painting with visible brushstrokes, thick paint texture\"`\n- Preserve composition: `\"Change to Bauhaus style while maintaining the original composition\"`\n\n### 3. Character Consistency\n**Framework:**\n- Specific description: `\"The woman with short black hair\"` instead of \"she\"\n- Preserve features: `\"while maintaining the same facial features, hairstyle, and expression\"`\n- Step-by-step modifications: Change background first, then actions\n\n### 4. Text Editing\n- Use quotes: `\"Replace 'joy' with 'BFL'\"`\n- Maintain format: `\"Replace text while maintaining the same font style\"`\n\n## Common Problem Solutions\n\n### Character Changes Too Much\n❌ Wrong: `\"Transform the person into a Viking\"`\n✅ Correct: `\"Change the clothes to be a viking warrior while preserving facial features\"`\n\n### Composition Position Changes\n❌ Wrong: `\"Put him on a beach\"`\n✅ Correct: `\"Change the background to a beach while keeping the person in the exact same position, scale, and pose\"`\n\n### Style Application Inaccuracy\n❌ Wrong: `\"Make it a sketch\"`\n✅ Correct: `\"Convert to pencil sketch with natural graphite lines, cross-hatching, and visible paper texture\"`\n\n## Core Principles\n\n1. **Be Specific and Clear** - Use precise descriptions, avoid vague terms\n2. **Step-by-step Editing** - Break complex modifications into multiple simple steps\n3. **Explicit Preservation** - State what should remain unchanged\n4. **Verb Selection** - Use \"change\", \"replace\" rather than \"transform\"\n\n## Best Practice Templates\n\n**Object Modification:**\n`\"Change [object] to [new state], keep [content to preserve] unchanged\"`\n\n**Style Transfer:**\n`\"Transform to [specific style], while maintaining [composition/character/other] unchanged\"`\n\n**Background Replacement:**\n`\"Change the background to [new background], keep the subject in the exact same position and pose\"`\n\n**Text Editing:**\n`\"Replace '[original text]' with '[new text]', maintain the same font style\"`\n\n> **Remember:** The more specific, the better. Kontext excels at understanding detailed instructions and maintaining consistency. "],"color":"#432","bgcolor":"#653"},{"id":184,"type":"MarkdownNote","pos":[-960,40],"size":[510,400],"flags":{},"order":4,"mode":0,"inputs":[],"outputs":[],"title":"Model links","properties":{"widget_ue_connectable":{}},"widgets_values":["[tutorial](http://docs.comfy.org/tutorials/flux/flux-1-kontext-dev) | [教程](http://docs.comfy.org/zh-CN/tutorials/flux/flux-1-kontext-dev)\n\n**diffusion model**\n\n- [flux1-dev-kontext_fp8_scaled.safetensors](https://huggingface.co/Comfy-Org/flux1-kontext-dev_ComfyUI/resolve/main/split_files/diffusion_models/flux1-dev-kontext_fp8_scaled.safetensors)\n\n**vae**\n\n- [ae.safetensors](https://huggingface.co/Comfy-Org/Lumina_Image_2.0_Repackaged/blob/main/split_files/vae/ae.safetensors)\n\n**text encoder**\n\n- [clip_l.safetensors](https://huggingface.co/comfyanonymous/flux_text_encoders/blob/main/clip_l.safetensors)\n- [t5xxl_fp16.safetensors](https://huggingface.co/comfyanonymous/flux_text_encoders/resolve/main/t5xxl_fp16.safetensors) or [t5xxl_fp8_e4m3fn_scaled.safetensors](https://huggingface.co/comfyanonymous/flux_text_encoders/resolve/main/t5xxl_fp8_e4m3fn_scaled.safetensors)\n\nModel Storage Location\n\n```\n📂 ComfyUI/\n├── 📂 models/\n│   ├── 📂 diffusion_models/\n│   │   └── flux1-dev-kontext_fp8_scaled.safetensors\n│   ├── 📂 vae/\n│   │   └── ae.safetensor\n│   └── 📂 text_encoders/\n│       ├── clip_l.safetensors\n│       └── t5xxl_fp16.safetensors 或者 t5xxl_fp8_e4m3fn_scaled.safetensors\n```\n"],"color":"#432","bgcolor":"#653"},{"id":177,"type":"ReferenceLatent","pos":[10,140],"size":[197.712890625,46],"flags":{},"order":19,"mode":0,"inputs":[{"localized_name":"conditioning","name":"conditioning","type":"CONDITIONING","link":294},{"localized_name":"latent","name":"latent","shape":7,"type":"LATENT","link":293}],"outputs":[{"localized_name":"CONDITIONING","name":"CONDITIONING","type":"CONDITIONING","links":[292]}],"properties":{"cnr_id":"comfy-core","ver":"0.3.41","Node name for S&R":"ReferenceLatent","widget_ue_connectable":{}},"widgets_values":[]},{"id":38,"type":"DualCLIPLoader","pos":[-397.5133972167969,203.8184356689453],"size":[337.76861572265625,130],"flags":{},"order":5,"mode":0,"inputs":[{"localized_name":"clip_name1","name":"clip_name1","type":"COMBO","widget":{"name":"clip_name1"},"link":null},{"localized_name":"clip_name2","name":"clip_name2","type":"COMBO","widget":{"name":"clip_name2"},"link":null},{"localized_name":"type","name":"type","type":"COMBO","widget":{"name":"type"},"link":null},{"localized_name":"device","name":"device","shape":7,"type":"COMBO","widget":{"name":"device"},"link":null}],"outputs":[{"localized_name":"CLIP","name":"CLIP","type":"CLIP","links":[59]}],"properties":{"cnr_id":"comfy-core","ver":"0.3.38","Node name for S&R":"DualCLIPLoader","models":[{"name":"clip_l.safetensors","url":"https://huggingface.co/comfyanonymous/flux_text_encoders/resolve/main/clip_l.safetensors","directory":"text_encoders"},{"name":"t5xxl_fp8_e4m3fn_scaled.safetensors","url":"https://huggingface.co/comfyanonymous/flux_text_encoders/resolve/main/t5xxl_fp8_e4m3fn_scaled.safetensors","directory":"text_encoders"}],"widget_ue_connectable":{}},"widgets_values":["clip_l.safetensors","t5/t5xxl_fp8_e4m3fn.safetensors","flux","default"],"color":"#322","bgcolor":"#533"},{"id":39,"type":"VAELoader","pos":[-397.5133972167969,383.81854248046875],"size":[337.76861572265625,58],"flags":{},"order":6,"mode":0,"inputs":[{"localized_name":"vae_name","name":"vae_name","type":"COMBO","widget":{"name":"vae_name"},"link":null}],"outputs":[{"localized_name":"VAE","name":"VAE","type":"VAE","links":[61,223]}],"properties":{"cnr_id":"comfy-core","ver":"0.3.38","Node name for S&R":"VAELoader","models":[{"name":"ae.safetensors","url":"https://huggingface.co/Comfy-Org/Lumina_Image_2.0_Repackaged/resolve/main/split_files/vae/ae.safetensors","directory":"vae"}],"widget_ue_connectable":{}},"widgets_values":["FLUX1/ae.safetensors"],"color":"#322","bgcolor":"#533"},{"id":136,"type":"SaveImage","pos":[907.8787841796875,154.09373474121094],"size":[650,660],"flags":{},"order":23,"mode":0,"inputs":[{"localized_name":"images","name":"images","type":"IMAGE","link":240},{"localized_name":"filename_prefix","name":"filename_prefix","type":"STRING","widget":{"name":"filename_prefix"},"link":null}],"outputs":[],"properties":{"cnr_id":"comfy-core","ver":"0.3.39","Node name for S&R":"SaveImage","widget_ue_connectable":{}},"widgets_values":["ComfyUI"]},{"id":190,"type":"MarkdownNote","pos":[-947.442138671875,-131.05972290039062],"size":[387.64630126953125,121.45352172851562],"flags":{},"order":7,"mode":0,"inputs":[],"outputs":[],"properties":{"widget_ue_connectable":{}},"widgets_values":["Download the model from [HuggingFace](https://huggingface.co/mit-han-lab/nunchaku-flux.1-kontext-dev) or [ModelScope](https://modelscope.cn/models/Lmxyy1999/nunchaku-flux.1-kontext-dev).\n\n- Use the **FP4** variant if you're running on **Blackwell (50-series) GPUs**.\n- Otherwise, choose the **INT4** version for better compatibility.\n\nYou can adjust the `cache_threshold` parameter to balance **image quality** and **inference speed**. A value of `0.12` typically offers a good trade-off.\n\nEnable `cpu_offload` to **save GPU memory** if you're running into memory limits.\n"],"color":"#432","bgcolor":"#653"},{"id":189,"type":"NunchakuFluxDiTLoader","pos":[-863.2089233398438,-432.5847473144531],"size":[275.7613220214844,202],"flags":{},"order":8,"mode":0,"inputs":[{"localized_name":"model_path","name":"model_path","type":"COMBO","widget":{"name":"model_path"},"link":null},{"localized_name":"cache_threshold","name":"cache_threshold","type":"FLOAT","widget":{"name":"cache_threshold"},"link":null},{"localized_name":"attention","name":"attention","type":"COMBO","widget":{"name":"attention"},"link":null},{"localized_name":"cpu_offload","name":"cpu_offload","type":"COMBO","widget":{"name":"cpu_offload"},"link":null},{"localized_name":"device_id","name":"device_id","type":"INT","widget":{"name":"device_id"},"link":null},{"localized_name":"data_type","name":"data_type","type":"COMBO","widget":{"name":"data_type"},"link":null},{"localized_name":"i2f_mode","name":"i2f_mode","shape":7,"type":"COMBO","widget":{"name":"i2f_mode"},"link":null}],"outputs":[{"localized_name":"MODEL","name":"MODEL","type":"MODEL","links":[301]}],"properties":{"cnr_id":"ComfyUI-nunchaku","ver":"3b2c771cf2f4e62f97c284bfd8f594482c5f8bc0","Node name for S&R":"NunchakuFluxDiTLoader","widget_ue_connectable":{}},"widgets_values":["FLUX1/svdq-int4_r32-flux.1-kontext-dev.safetensors",0,"nunchaku-fp16","auto",0,"bfloat16","enabled"]},{"id":31,"type":"KSampler","pos":[536.3323364257812,-30.446378707885742],"size":[320,474],"flags":{},"order":21,"mode":0,"inputs":[{"localized_name":"model","name":"model","type":"MODEL","link":302},{"localized_name":"positive","name":"positive","type":"CONDITIONING","link":57},{"localized_name":"negative","name":"negative","type":"CONDITIONING","link":238},{"localized_name":"latent_image","name":"latent_image","type":"LATENT","link":291},{"localized_name":"seed","name":"seed","type":"INT","widget":{"name":"seed"},"link":null},{"localized_name":"steps","name":"steps","type":"INT","widget":{"name":"steps"},"link":null},{"localized_name":"cfg","name":"cfg","type":"FLOAT","widget":{"name":"cfg"},"link":null},{"localized_name":"sampler_name","name":"sampler_name","type":"COMBO","widget":{"name":"sampler_name"},"link":null},{"localized_name":"scheduler","name":"scheduler","type":"COMBO","widget":{"name":"scheduler"},"link":null},{"localized_name":"denoise","name":"denoise","type":"FLOAT","widget":{"name":"denoise"},"link":null}],"outputs":[{"localized_name":"LATENT","name":"LATENT","type":"LATENT","slot_index":0,"links":[52]}],"properties":{"cnr_id":"comfy-core","ver":"0.3.38","Node name for S&R":"KSampler","widget_ue_connectable":{}},"widgets_values":[771464493621168,"randomize",20,1,"euler","simple",1]},{"id":192,"type":"HintImageEnchance","pos":[-386.385498046875,782.2907104492188],"size":[316.2369079589844,106],"flags":{},"order":12,"mode":4,"inputs":[{"localized_name":"hint_image","name":"hint_image","type":"IMAGE","link":298},{"localized_name":"image_gen_width","name":"image_gen_width","type":"INT","widget":{"name":"image_gen_width"},"link":null},{"localized_name":"image_gen_height","name":"image_gen_height","type":"INT","widget":{"name":"image_gen_height"},"link":null},{"localized_name":"resize_mode","name":"resize_mode","type":"COMBO","widget":{"name":"resize_mode"},"link":null}],"outputs":[{"localized_name":"IMAGE","name":"IMAGE","type":"IMAGE","links":[299]}],"properties":{"cnr_id":"comfyui_controlnet_aux","ver":"1.0.7","Node name for S&R":"HintImageEnchance","widget_ue_connectable":{}},"widgets_values":[1024,1024,"Just Resize"]},{"id":142,"type":"LoadImageOutput","pos":[-401.3706970214844,933.9597778320312],"size":[320,374],"flags":{},"order":9,"mode":0,"inputs":[{"localized_name":"image","name":"image","type":"COMBO","widget":{"name":"image"},"link":null},{"localized_name":"upload","name":"upload","type":"IMAGEUPLOAD","widget":{"name":"upload"},"link":null}],"outputs":[{"localized_name":"IMAGE","name":"IMAGE","type":"IMAGE","links":[298,303]},{"localized_name":"MASK","name":"MASK","type":"MASK","links":null}],"properties":{"cnr_id":"comfy-core","ver":"0.3.40","Node name for S&R":"LoadImageOutput","widget_ue_connectable":{}},"widgets_values":["ComfyUI_01219_.png [output]",false,"refresh","image"],"color":"#322","bgcolor":"#533"},{"id":194,"type":"SaveImage","pos":[-738.6974487304688,958.37109375],"size":[270,270],"flags":{},"order":13,"mode":0,"inputs":[{"localized_name":"images","name":"images","type":"IMAGE","link":303},{"localized_name":"filename_prefix","name":"filename_prefix","type":"STRING","widget":{"name":"filename_prefix"},"link":null}],"outputs":[],"properties":{"cnr_id":"comfy-core","ver":"0.3.43","Node name for S&R":"SaveImage","widget_ue_connectable":{}},"widgets_values":["ComfyUI"]},{"id":193,"type":"NunchakuFluxLoraLoader","pos":[-475.7606506347656,-369.6185302734375],"size":[300.6851501464844,82],"flags":{},"order":11,"mode":0,"inputs":[{"localized_name":"model","name":"model","type":"MODEL","link":301},{"localized_name":"lora_name","name":"lora_name","type":"COMBO","widget":{"name":"lora_name"},"link":null},{"localized_name":"lora_strength","name":"lora_strength","type":"FLOAT","widget":{"name":"lora_strength"},"link":null}],"outputs":[{"localized_name":"MODEL","name":"MODEL","type":"MODEL","links":[302]}],"properties":{"cnr_id":"comfyui-nunchaku","ver":"0.3.3","Node name for S&R":"NunchakuFluxLoraLoader","widget_ue_connectable":{}},"widgets_values":["Grace-Kontext_UltimateLoRA.safetensors",1]},{"id":6,"type":"CLIPTextEncode","pos":[330,560],"size":[400,220],"flags":{},"order":10,"mode":0,"inputs":[{"localized_name":"clip","name":"clip","type":"CLIP","link":59},{"localized_name":"text","name":"text","type":"STRING","widget":{"name":"text"},"link":null}],"outputs":[{"localized_name":"CONDITIONING","name":"CONDITIONING","type":"CONDITIONING","slot_index":0,"links":[237,294]}],"title":"CLIP Text Encode (Positive Prompt)","properties":{"cnr_id":"comfy-core","ver":"0.3.38","Node name for S&R":"CLIPTextEncode","widget_ue_connectable":{}},"widgets_values":["Make this image into gr4cesty1e"],"color":"#232","bgcolor":"#353"},{"id":35,"type":"FluxGuidance","pos":[250,90],"size":[240,58],"flags":{"collapsed":false},"order":20,"mode":0,"inputs":[{"localized_name":"conditioning","name":"conditioning","type":"CONDITIONING","link":292},{"localized_name":"guidance","name":"guidance","type":"FLOAT","widget":{"name":"guidance"},"link":null}],"outputs":[{"localized_name":"CONDITIONING","name":"CONDITIONING","type":"CONDITIONING","slot_index":0,"links":[57]}],"properties":{"cnr_id":"comfy-core","ver":"0.3.38","Node name for S&R":"FluxGuidance","widget_ue_connectable":{}},"widgets_values":[5]}],"links":[[52,31,0,8,0,"LATENT"],[57,35,0,31,1,"CONDITIONING"],[59,38,0,6,0,"CLIP"],[61,39,0,8,1,"VAE"],[222,42,0,124,0,"IMAGE"],[223,39,0,124,1,"VAE"],[237,6,0,135,0,"CONDITIONING"],[238,135,0,31,2,"CONDITIONING"],[240,8,0,136,0,"IMAGE"],[250,147,0,146,1,"IMAGE"],[251,146,0,42,0,"IMAGE"],[289,42,0,173,0,"IMAGE"],[291,124,0,31,3,"LATENT"],[292,177,0,35,0,"CONDITIONING"],[293,124,0,177,1,"LATENT"],[294,6,0,177,0,"CONDITIONING"],[298,142,0,192,0,"IMAGE"],[299,192,0,146,0,"IMAGE"],[301,189,0,193,0,"MODEL"],[302,193,0,31,0,"MODEL"],[303,142,0,194,0,"IMAGE"]],"groups":[{"id":3,"title":"Step 2 - Upload images","bounding":[-410,480,700,680],"color":"#3f789e","font_size":24,"flags":{}},{"id":5,"title":"Step 3 - Prompt","bounding":[310,480,430,330],"color":"#3f789e","font_size":24,"flags":{}},{"id":6,"title":"Conditioning","bounding":[-30,10,540,250],"color":"#3f789e","font_size":24,"flags":{}}],"config":{},"extra":{"ds":{"scale":0.6588450000000003,"offset":[1434.231327402801,45.00906782171184]},"frontendVersion":"1.23.4","groupNodes":{},"VHS_latentpreview":false,"VHS_latentpreviewrate":0,"VHS_MetadataImage":true,"VHS_KeepIntermediate":true,"ue_links":[],"links_added_by_ue":[]},"version":0.4}